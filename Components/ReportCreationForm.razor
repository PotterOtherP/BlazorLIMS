@using System;
@using BlazorLIMS.Data;

<div style="display: flex; flex-direction: column; width: 30%">

<h1 style="margin: 20px">PWSM Lab Receiving</h1>

<select @bind="CreateSampleType" style="margin: 20px">
    <option value="Plant">Plant</option>
    <option value="Waste">Waste</option>
    <option value="Solution">Solution</option>
    <option value="Media">Media</option>
</select>

<select @bind="CreateReportType" style="margin: 20px">
    <option value="Predictive">Predictive</option>
    <option value="Diagnostic">Diagnostic</option>
    <option value="Research">Research</option>
    <option value="Internal">Internal</option>
    <option value="OutOfState">Out of State</option>
</select>

<select @bind="CreateSampleCode" style="margin: 20px">
    @{
        if (CreateSampleType == "Plant")
        {
            foreach(string pCode in Info.PlantCodes)
            {
                <option value="@pCode">@pCode</option>
            }
        }

        else if (CreateSampleType == "Waste")
        {
            foreach(string wCode in Info.WasteCodes)
            {
                <option value="@wCode">@wCode</option>
            }
        }

        else if (CreateSampleType == "Solution")
        {
            foreach(string sCode in Info.SolutionCodes)
            {
                <option value="@sCode">@sCode</option>
            }
        }

        else if (CreateSampleType == "Media")
        {
            foreach(string mCode in Info.MediaCodes)
            {
                <option value="@mCode">@mCode</option>
            }
        }
    }
</select>

<input @bind="CreateNumberOfSamples" type="number" style="margin: 20px; width: 15%">

<input @bind="CreateReportDate" type="date" style="margin: 20px; width: 35%">

<button @onclick="CreateReportFromForm" style="margin: 20px">Create Grid</button>

</div>

@code {

    private string CreateReportType = "Predictive";
    private string CreateSampleType = "Plant";
    private string CreateSampleCode = Info.PlantCodes[0];
    private int CreateNumberOfSamples = 1;
    private DateTime CreateReportDate = DateTime.Now;

    [Parameter]
    public ReportModel CreatedReport { get; set; }

    [Parameter]
    public EventCallback OnClickCallback { get; set; }

    private async void CreateReportFromForm() {

        // Get next report number and sample numbers from database
        // CreatedReport.LabReportId = ;
        // int nextSampleId = ;
        int nextSampleId = 1001;


        CreatedReport.SampleType = CreateSampleType;
        CreatedReport.ReportType = CreateReportType;
        CreatedReport.IsComplete = false;
        CreatedReport.IsDeleted = false;
        CreatedReport.DateReceived = CreateReportDate;
        CreatedReport.Samples = new List<SampleModel>();

        for (int i = 0; i < CreateNumberOfSamples; ++i)
        {
            var s = new SampleModel();
            s.LabId = nextSampleId + i;
            s.SampleType = CreateSampleType;
            s.SampleCode = CreateSampleCode;
            CreatedReport.Samples.Add(s);
        }

        await OnClickCallback.InvokeAsync();

    }
}